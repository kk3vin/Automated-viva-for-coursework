{"version":3,"sources":["../src/recordAudio.js"],"names":["define","$","Ajax","ModalFactory","String","ModalEvents","mediaStream","mediaRecorder","recorderFile","stopRecordCallback","videosContainer","document","getElementById","user_i","classList","user_id","substr","lastIndexOf","filearea","filearea_name","draft_context","draft_contextid","real_context","real_contextid","course_name","course_id","user_n","user_name","course_u","course_url","time_limitation_u","time_limitation","trigger","create","type","types","SAVE_CANCEL","title","get_string","body","large","done","modal","setSaveButtonText","getRoot","on","save","e","preventDefault","removeAttr","start_time_counting","startRecord","prop","click","Y","log","window","addEventListener","len","childNodes","length","i","removeChild","video","createElement","setAttribute","controls","muted","width","height","MediaUtils","getUserMedia","err","stream","audio_stream","MediaStream","getAudioTracks","video_stream","getVideoTracks","MediaRecorder","chunks","srcObject","play","append","ondataavailable","blobs","push","data","onstop","Blob","mimeType","videoEnable","audioEnable","callback","navigator","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","constraints","audio","mediaDevices","then","Error","closeStream","stop","trackList","tracks","j","track","start","hide","stopRecord","sendFile","file","File","filename","name","fileBase64","reader","FileReader","readAsDataURL","onload","result","split","params","call","methodname","args","location","href","fail","error","mins","timeBar","id","setInterval","clearInterval","style"],"mappings":"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","sourcesContent":["define(['jquery', 'core/ajax', 'core/modal_factory', 'core/str','core/modal_events'],\n    function ($,Ajax, ModalFactory, String, ModalEvents) {\n        var mediaStream;\n        var mediaRecorder;\n        var recorderFile;\n        var stopRecordCallback;\n        var videosContainer = document.getElementById('videos-container');\n\n        let user_i = $('.end_button')[0].classList[1];\n        let user_id = user_i.substr(user_i.lastIndexOf('save_record_userid_') + 'save_record_userid_'.length);\n        let filearea = $('.end_button')[0].classList[2];\n        let filearea_name = filearea.substr(filearea.lastIndexOf('save_record_filearea_') + 'save_record_filearea_'.length);\n        let draft_context = $('.end_button')[0].classList[3];\n        let draft_contextid = draft_context.substr(draft_context.lastIndexOf('save_record_draftcontextid_'\n        ) + 'save_record_draftcontextid_'.length);\n        let real_context = $('.end_button')[0].classList[4];\n        let real_contextid = real_context.substr(real_context.lastIndexOf('save_record_realcontextid_'\n        ) + 'save_record_realcontextid_'.length);\n        let course_name = $('.next_question_button')[0].classList[2];\n        let course_id = course_name.substr(course_name.lastIndexOf('next_button_') + 'next_button_'.length);\n        let user_n = $('.end_button')[0].classList[5];\n        let user_name = user_n.substr(user_n.lastIndexOf('save_record_username_') + 'save_record_username_'.length);\n        let course_u = $('.end_button')[0].classList[6];\n        let course_url = course_u.substr(course_u.lastIndexOf('save_record_courseurl_') + 'save_record_courseurl_'.length);\n        let time_limitation_u = $('.end_button')[0].classList[7];\n        let time_limitation = time_limitation_u.substr(time_limitation_u.lastIndexOf('save_record_timeLimitation_')\n            + 'save_record_timeLimitation_'.length);\n\n\n\n        var trigger = $('.record_button');\n    ModalFactory.create({\n        type:ModalFactory.types.SAVE_CANCEL,\n        title:String.get_string('title','local_aot'),\n        body:String.get_string('ready_viva', 'local_aot'),\n        large:true,\n    },trigger).done(function (modal) {\n        modal.setSaveButtonText(String.get_string('confirm_viva', 'local_aot'));\n        modal.getRoot().on(ModalEvents.save, function (e) {\n            e.preventDefault();\n            $('.next_question_button').removeAttr('disabled');\n            // $('.previous_question_button').removeAttr('disabled');\n            start_time_counting(time_limitation);\n            startRecord(modal);\n            $('.record_button').prop(\"disabled\", true);\n        });\n    });\n\n\n    // $('.record_button').click(function () {\n    //     Y.log('Start recording');\n    //     startRecord();\n    // });\n\n    $('.end_button').click(function () {\n        Y.log('Save recording');\n        Y.log(course_url);\n        save();\n    });\n\n\n\n\n\n\n\n    // $('.take_photo_btn').click(function () {\n    //     takePhoto();\n    // });\n\n    // Ready to record\n    window.addEventListener('load', function () {\n            var len = videosContainer.childNodes.length;\n            for(var i=0;i<len;i++){\n                videosContainer.removeChild(videosContainer.childNodes[i]);\n            }\n            var video = document.createElement('video');\n            video.setAttribute('class', 'video_to_display');\n\n            var videoWidth = 250;\n            var videoHeight = 200;\n\n            video.controls = false;\n            video.muted = true;\n            video.width = videoWidth;\n            video.height = videoHeight;\n\n            MediaUtils.getUserMedia(true, true, function (err, stream) {\n                if (err) {\n                    throw err;\n                } else {\n                    var audio_stream = new MediaStream(stream.getAudioTracks());\n                     var video_stream = new MediaStream(stream.getVideoTracks());\n                    mediaRecorder = new MediaRecorder(audio_stream);\n                    mediaStream = audio_stream;\n                    var chunks = [];\n                    video.srcObject = video_stream;\n                    video.play();\n                    videosContainer.append(video);\n\n                    mediaRecorder.ondataavailable = function(e) {\n                        mediaRecorder.blobs.push(e.data);\n                        chunks.push(e.data);\n                    };\n                    mediaRecorder.blobs = [];\n\n                    mediaRecorder.onstop = function () {\n                        recorderFile = new Blob(chunks, { 'type' : mediaRecorder.mimeType });\n                        chunks = [];\n                        if (stopRecordCallback !== null) {\n                            stopRecordCallback();\n                        }\n                    };\n                }\n            });\n    });\n\n    var MediaUtils = {\n        getUserMedia: function (videoEnable, audioEnable, callback) {\n            navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia\n                || navigator.msGetUserMedia || window.getUserMedia;\n            var constraints = {video: videoEnable, audio: audioEnable};\n            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n                navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {\n                    callback(false, stream);\n                })['catch'](function(err) {\n                    callback(err);\n                });\n            } else if (navigator.getUserMedia) {\n                navigator.getUserMedia(constraints, function (stream) {\n                    callback(false, stream);\n                }, function (err) {\n                    callback(err);\n                });\n            } else {\n                callback(new Error('Not support userMedia'));\n            }\n        },\n\n\n        closeStream: function (stream) {\n            if (typeof stream.stop === 'function') {\n                stream.stop();\n            }\n\n            else {\n                let trackList = [stream.getAudioTracks(), stream.getVideoTracks()];\n\n                for (let i = 0; i < trackList.length; i++) {\n                    let tracks = trackList[i];\n                    if (tracks && tracks.length > 0) {\n                        for (let j = 0; j < tracks.length; j++) {\n                            let track = tracks[j];\n                            if (typeof track.stop === 'function') {\n                                track.stop();\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    };\n    // function takePhoto() {\n    //     let canvas = $('.snapshot_canvas')[0];\n    //     let ctx = canvas.getContext('2d');\n    //     var video = $('.video_to_display')[0];\n    //     ctx.drawImage(video, 0,0,420,240);\n    //     var img_base64 = canvas.toDataURL().split(',')[1];\n    //     var filename = 'profile_img_'+user_name + '.jpg';\n    //     let params = {'imgfile':img_base64, 'userid':user_id, 'fileareaname':'profile_img',\n    //         'draftcontextid':draft_contextid, 'realcontextid':real_contextid, 'courseid':course_id,\n    //         'filename':filename};\n    //\n    //     let request = {\n    //         methodname:'local_aot_upload_snapshot',\n    //         args:params,\n    //     };\n    //\n    //     Ajax.call([request])[0].done(function (data){\n    //         if(data==true){\n    //             Y.log('img success upload');\n    //         }else {\n    //             Y.log('img did not upload');\n    //         }\n    //     }).fail(function (error) {\n    //         Y.log(error);\n    //         Y.log('failed');\n    //     });\n    //\n    // }\n\n    function startRecord(modal){\n            mediaRecorder.start();\n            modal.hide();\n    }\n\n    function stopRecord(callback) {\n            stopRecordCallback = callback;\n            mediaRecorder.stop();\n            MediaUtils.closeStream(mediaStream);\n            Y.log(\"stop recording\");\n    }\n    function sendFile(){\n                var file = new File([recorderFile], user_name + '.mp3', {\n                    type: 'audio/mp3'\n                });\n                var filename = file.name;\n                Y.log(file);\n                var fileBase64;\n                let reader = new FileReader();\n                reader.readAsDataURL(file);\n                reader.onload = function () {\n                fileBase64 = reader.result.split(',')[1];\n                let params = {'videofile':fileBase64, 'userid':user_id, 'fileareaname':filearea_name,\n                    'draftcontextid':draft_contextid, 'realcontextid':real_contextid, 'courseid':course_id,\n                    'filename':filename};\n                let request = {\n                    methodname:'local_aot_upload_video',\n                    args:params,\n                };\n\n                Ajax.call([request])[0].done(function (data){\n                    if(data==true){\n                        Y.log('success upload');\n                        window.location.href=course_url;\n                    }else {\n                        Y.log('did not upload');\n                    }\n                }).fail(function (error) {\n                    Y.log(error);\n                    Y.log('failed');\n                });\n            };\n    }\n    function start_time_counting(mins) {\n        var timeBar = document.getElementById('timeBar');\n        var width = 0;\n        var id = setInterval(start, 1000);\n        function start() {\n            if(width>=100){\n                clearInterval(id);\n                save();\n            }else{\n                width+=5/(3*mins);\n                timeBar.style.width=width+'%';\n            }\n        }\n    }\n    function save() {\n            stopRecord(function () {\n                sendFile();\n            });\n        }\n    }\n);"],"file":"recordAudio.min.js"}