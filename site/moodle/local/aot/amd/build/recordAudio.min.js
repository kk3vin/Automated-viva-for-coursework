define ("local_aot/recordAudio",["jquery","core/ajax","core/modal_factory","core/str","core/modal_events"],function(a,b,c,d,e){var k,l,m,n,o=document.getElementById("videos-container"),p=a(".end_button")[0].classList[1],q=p.substr(p.lastIndexOf("save_record_userid_")+19),r=a(".end_button")[0].classList[2],s=r.substr(r.lastIndexOf("save_record_filearea_")+21),t=a(".end_button")[0].classList[3],u=t.substr(t.lastIndexOf("save_record_draftcontextid_")+27),v=a(".end_button")[0].classList[4],w=v.substr(v.lastIndexOf("save_record_realcontextid_")+26),x=a(".next_question_button")[0].classList[2],y=x.substr(x.lastIndexOf("next_button_")+12),z=a(".end_button")[0].classList[5],A=z.substr(z.lastIndexOf("save_record_username_")+21),B=a(".end_button")[0].classList[6],C=B.substr(B.lastIndexOf("save_record_courseurl_")+22),D=a(".end_button")[0].classList[7],E=D.substr(D.lastIndexOf("save_record_timeLimitation_")+27),F=a(".record_button");c.create({type:c.types.SAVE_CANCEL,title:d.get_string("title","local_aot"),body:d.get_string("ready_viva","local_aot"),large:!0},F).done(function(b){b.setSaveButtonText(d.get_string("confirm_viva","local_aot"));b.getRoot().on(e.save,function(c){c.preventDefault();a(".next_question_button").removeAttr("disabled");i(E);f(b);a(".record_button").prop("disabled",!0)})});a(".end_button").click(function(){Y.log("Save recording");Y.log(C);j()});window.addEventListener("load",function(){for(var a=o.childNodes.length,b=0;b<a;b++){o.removeChild(o.childNodes[b])}var c=document.createElement("video");c.setAttribute("class","video_to_display");c.controls=!1;c.muted=!0;c.width=250;c.height=200;G.getUserMedia(!0,!0,function(a,b){if(a){throw a}else{var d=new MediaStream(b.getAudioTracks()),e=new MediaStream(b.getVideoTracks());l=new MediaRecorder(d);k=d;var f=[];c.srcObject=e;c.play();o.append(c);l.ondataavailable=function(a){l.blobs.push(a.data);f.push(a.data)};l.blobs=[];l.onstop=function(){m=new Blob(f,{type:l.mimeType});f=[];if(null!==n){n()}}}})});var G={getUserMedia:function getUserMedia(a,b,c){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||window.getUserMedia;var d={video:a,audio:b};if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){navigator.mediaDevices.getUserMedia(d).then(function(a){c(!1,a)})["catch"](function(a){c(a)})}else if(navigator.getUserMedia){navigator.getUserMedia(d,function(a){c(!1,a)},function(a){c(a)})}else{c(new Error("Not support userMedia"))}},closeStream:function closeStream(a){if("function"==typeof a.stop){a.stop()}else{for(var b=[a.getAudioTracks(),a.getVideoTracks()],c=0,d;c<b.length;c++){d=b[c];if(d&&0<d.length){for(var e=0,f;e<d.length;e++){f=d[e];if("function"==typeof f.stop){f.stop()}}}}}}};function f(a){l.start();a.hide()}function g(a){n=a;l.stop();G.closeStream(k);Y.log("stop recording")}function h(){var a=new File([m],A+".mp3",{type:"audio/mp3"}),c=a.name;Y.log(a);var d,e=new FileReader;e.readAsDataURL(a);e.onload=function(){d=e.result.split(",")[1];var a={videofile:d,userid:q,fileareaname:s,draftcontextid:u,realcontextid:w,courseid:y,filename:c};b.call([{methodname:"local_aot_upload_video",args:a}])[0].done(function(a){if(!0==a){Y.log("success upload");window.location.href=C}else{Y.log("did not upload")}}).fail(function(a){Y.log(a);Y.log("failed")})}}function i(a){var c=document.getElementById("timeBar"),d=0,e=setInterval(b,1e3);function b(){if(100<=d){clearInterval(e);j()}else{d+=5/(3*a);c.style.width=d+"%"}}}function j(){g(function(){h()})}});
//# sourceMappingURL=recordAudio.min.js.map
