define ("local_aot/controlCamera",["jquery","core/ajax"],function(a,b){var e,f,g,h;a(".open_camera").click(function(){i.getUserMedia(!1,!0,function(a,b){if(a){throw a}else{h=new MediaRecorder(b);e=b;var c=[];h.ondataavailable=function(a){h.blobs.push(a.data);c.push(a.data)};h.blobs=[];h.onstop=function(){f=new Blob(c,{type:h.mimeType});c=[];if(null!==g){g()}}}})});var i={getUserMedia:function getUserMedia(a,b,c){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||window.getUserMedia;var d={video:a,audio:b};if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){navigator.mediaDevices.getUserMedia(d).then(function(a){c(!1,a)})["catch"](function(a){c(a)})}else if(navigator.getUserMedia){navigator.getUserMedia(d,function(a){c(!1,a)},function(a){c(a)})}else{c(new Error("Not support userMedia"))}},closeStream:function closeStream(a){if("function"==typeof a.stop){a.stop()}else{for(var b=[a.getAudioTracks(),a.getVideoTracks()],c=0,d;c<b.length;c++){d=b[c];if(d&&0<d.length){for(var e=0,f;e<d.length;e++){f=d[e];if("function"==typeof f.stop){f.stop()}}}}}}};a(".close_camera").click(function(){c(function(){d()})});a(".start_recording").click(function(){Y.log("start recording");h.start()});function c(a){g=a;h.stop();i.closeStream(e);Y.log("stop recording")}function d(){var a=new File([f],"msr-"+new Date().toISOString().replace(/:|\./g,"-")+".mp3",{type:"audio/mp3"});Y.log(a);var c,d=new FileReader;d.readAsDataURL(a);d.onload=function(){c=d.result.split(",")[1];var a={videofile:c};b.call([{methodname:"local_aot_upload_video",args:a}])[0].done(function(a){if(!0==a){Y.log("success upload")}else{Y.log("did not upload")}}).fail(function(a){Y.log(a);Y.log("failed")})}}});
//# sourceMappingURL=controlCamera.min.js.map
