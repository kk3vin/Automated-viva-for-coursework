{"version":3,"sources":["../src/controlCamera.js"],"names":["define","$","Ajax","mediaStream","recorderFile","stopRecordCallback","mediaRecorder","click","MediaUtils","getUserMedia","err","stream","MediaRecorder","chunks","ondataavailable","e","blobs","push","data","onstop","Blob","mimeType","videoEnable","audioEnable","callback","navigator","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","window","constraints","video","audio","mediaDevices","then","Error","closeStream","stop","trackList","getAudioTracks","getVideoTracks","i","tracks","length","j","track","stopRecord","send","Y","log","start","file","File","Date","toISOString","replace","type","fileBase64","reader","FileReader","readAsDataURL","onload","result","split","params","call","methodname","args","done","fail","error"],"mappings":"AACAA,OAAM,2BAAC,CAAC,QAAD,CAAW,WAAX,CAAD,CAA0B,SAAUC,CAAV,CAAYC,CAAZ,CAAkB,IACtCC,CAAAA,CADsC,CAEtCC,CAFsC,CAGtCC,CAHsC,CAItCC,CAJsC,CAO1CL,CAAC,CAAC,cAAD,CAAD,CAAkBM,KAAlB,CAAwB,UAAY,CAe5BC,CAAU,CAACC,YAAX,OAAqC,SAAUC,CAAV,CAAeC,CAAf,CAAuB,CACpD,GAAID,CAAJ,CAAS,CACD,KAAMA,CAAAA,CACb,CAFD,IAEO,CACCJ,CAAa,CAAG,GAAIM,CAAAA,aAAJ,CAAkBD,CAAlB,CAAhB,CACAR,CAAW,CAAGQ,CAAd,CACA,GAAIE,CAAAA,CAAM,CAAG,EAAb,CAKAP,CAAa,CAACQ,eAAd,CAAgC,SAASC,CAAT,CAAY,CACpCT,CAAa,CAACU,KAAd,CAAoBC,IAApB,CAAyBF,CAAC,CAACG,IAA3B,EACAL,CAAM,CAACI,IAAP,CAAYF,CAAC,CAACG,IAAd,CACP,CAHD,CAIAZ,CAAa,CAACU,KAAd,CAAsB,EAAtB,CAEAV,CAAa,CAACa,MAAd,CAAuB,UAAY,CAC3Bf,CAAY,CAAG,GAAIgB,CAAAA,IAAJ,CAASP,CAAT,CAAiB,CAAE,KAASP,CAAa,CAACe,QAAzB,CAAjB,CAAf,CACAR,CAAM,CAAG,EAAT,CACA,GAA2B,IAAvB,GAAAR,CAAJ,CAAiC,CACzBA,CAAkB,EACzB,CACR,CACR,CACR,CAzBD,CA0BP,CAzCD,EA2CA,GAAIG,CAAAA,CAAU,CAAG,CAETC,YAAY,CAAE,sBAAUa,CAAV,CAAuBC,CAAvB,CAAoCC,CAApC,CAA8C,CACpDC,SAAS,CAAChB,YAAV,CAAyBgB,SAAS,CAAChB,YAAV,EAA0BgB,SAAS,CAACC,kBAApC,EAA0DD,SAAS,CAACE,eAApE,EAClBF,SAAS,CAACG,cADQ,EACUC,MAAM,CAACpB,YAD1C,CAEA,GAAIqB,CAAAA,CAAW,CAAG,CAACC,KAAK,CAAET,CAAR,CAAqBU,KAAK,CAAET,CAA5B,CAAlB,CACA,GAAIE,SAAS,CAACQ,YAAV,EAA0BR,SAAS,CAACQ,YAAV,CAAuBxB,YAArD,CAAmE,CAC3DgB,SAAS,CAACQ,YAAV,CAAuBxB,YAAvB,CAAoCqB,CAApC,EAAiDI,IAAjD,CAAsD,SAAUvB,CAAV,CAAkB,CAChEa,CAAQ,IAAQb,CAAR,CACf,CAFD,EAEG,OAFH,EAEY,SAASD,CAAT,CAAc,CAClBc,CAAQ,CAACd,CAAD,CACf,CAJD,CAKP,CAND,IAMO,IAAIe,SAAS,CAAChB,YAAd,CAA4B,CAC3BgB,SAAS,CAAChB,YAAV,CAAuBqB,CAAvB,CAAoC,SAAUnB,CAAV,CAAkB,CAC9Ca,CAAQ,IAAQb,CAAR,CACf,CAFD,CAEG,SAAUD,CAAV,CAAe,CACVc,CAAQ,CAACd,CAAD,CACf,CAJD,CAKP,CANM,IAMA,CACCc,CAAQ,CAAC,GAAIW,CAAAA,KAAJ,CAAU,uBAAV,CAAD,CACf,CACR,CArBQ,CAwBTC,WAAW,CAAE,qBAAUzB,CAAV,CAAkB,CACvB,GAA2B,UAAvB,QAAOA,CAAAA,CAAM,CAAC0B,IAAlB,CAAuC,CAC/B1B,CAAM,CAAC0B,IAAP,EACP,CAFD,IAIK,CAGG,OAFIC,CAAAA,CAAS,CAAG,CAAC3B,CAAM,CAAC4B,cAAP,EAAD,CAA0B5B,CAAM,CAAC6B,cAAP,EAA1B,CAEhB,CAASC,CAAC,CAAG,CAAb,CACYC,CADZ,CAAgBD,CAAC,CAAGH,CAAS,CAACK,MAA9B,CAAsCF,CAAC,EAAvC,CAA2C,CAC/BC,CAD+B,CACtBJ,CAAS,CAACG,CAAD,CADa,CAEnC,GAAIC,CAAM,EAAoB,CAAhB,CAAAA,CAAM,CAACC,MAArB,CAAiC,CACzB,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAR,CACOC,CADZ,CAAgBD,CAAC,CAAGF,CAAM,CAACC,MAA3B,CAAmCC,CAAC,EAApC,CAAwC,CAC5BC,CAD4B,CACpBH,CAAM,CAACE,CAAD,CADc,CAEhC,GAA0B,UAAtB,QAAOC,CAAAA,CAAK,CAACR,IAAjB,CAAsC,CAC9BQ,CAAK,CAACR,IAAN,EACP,CACR,CACR,CACR,CACR,CACR,CA5CQ,CAAjB,CA+CApC,CAAC,CAAC,eAAD,CAAD,CAAmBM,KAAnB,CAAyB,UAAY,CAC7BuC,CAAU,CAAC,UAAY,CAChBC,CAAI,EACV,CAFS,CAGjB,CAJD,EAMA9C,CAAC,CAAC,kBAAD,CAAD,CAAsBM,KAAtB,CAA4B,UAAY,CAChCyC,CAAC,CAACC,GAAF,CAAM,iBAAN,EACA3C,CAAa,CAAC4C,KAAd,EACP,CAHD,EAKA,QAASJ,CAAAA,CAAT,CAAoBtB,CAApB,CAA8B,CACtBnB,CAAkB,CAAGmB,CAArB,CACAlB,CAAa,CAAC+B,IAAd,GACA7B,CAAU,CAAC4B,WAAX,CAAuBjC,CAAvB,EACA6C,CAAC,CAACC,GAAF,CAAM,gBAAN,CACP,CAED,QAASF,CAAAA,CAAT,EAAgB,CACR,GAAII,CAAAA,CAAI,CAAG,GAAIC,CAAAA,IAAJ,CAAS,CAAChD,CAAD,CAAT,CAAyB,OAAU,GAAIiD,CAAAA,IAAJ,EAAD,CAAWC,WAAX,GAAyBC,OAAzB,CAAiC,OAAjC,CAA0C,GAA1C,CAAT,CAA0D,MAAnF,CAA2F,CAC9FC,IAAI,CAAE,WADwF,CAA3F,CAAX,CAGAR,CAAC,CAACC,GAAF,CAAME,CAAN,EAJQ,GAKJM,CAAAA,CALI,CAMJC,CAAM,CAAG,GAAIC,CAAAA,UANT,CAORD,CAAM,CAACE,aAAP,CAAqBT,CAArB,EACAO,CAAM,CAACG,MAAP,CAAgB,UAAY,CACpBJ,CAAU,CAAGC,CAAM,CAACI,MAAP,CAAcC,KAAd,CAAoB,GAApB,EAAyB,CAAzB,CAAb,CADoB,GAExBC,CAAAA,CAAM,CAAG,CAAC,UAAYP,CAAb,CAFe,CAS5BvD,CAAI,CAAC+D,IAAL,CAAU,CALI,CACNC,UAAU,CAAC,wBADL,CAENC,IAAI,CAACH,CAFC,CAKJ,CAAV,EAAqB,CAArB,EAAwBI,IAAxB,CAA6B,SAAUlD,CAAV,CAAe,CACpC,GAAG,IAAAA,CAAH,CAAc,CACN8B,CAAC,CAACC,GAAF,CAAM,gBAAN,CACP,CAFD,IAEM,CACED,CAAC,CAACC,GAAF,CAAM,gBAAN,CACP,CACR,CAND,EAMGoB,IANH,CAMQ,SAAUC,CAAV,CAAiB,CACjBtB,CAAC,CAACC,GAAF,CAAMqB,CAAN,EACAtB,CAAC,CAACC,GAAF,CAAM,QAAN,CACP,CATD,CAUC,CACR,CAyBJ,CAxKC,CAAN","sourcesContent":["\ndefine(['jquery', 'core/ajax'], function ($,Ajax) {\n        var mediaStream;\n        var recorderFile;\n        var stopRecordCallback;\n        var mediaRecorder;\n        // var videosContainer = $('#videos-container');\n\n        $('.open_camera').click(function () {\n                // var len = videosContainer.children().length;\n                // for(var i=0;i<len;i++){\n                //         videosContainer.removeChild(videosContainer.childNodes[i]);\n                // }\n\n                // var video = document.createElement('video');\n                //\n                // var videoWidth = 420;\n                // var videoHeight = 240;\n                //\n                // video.controls = false;\n                // video.muted = true;\n                // video.width = videoWidth;\n                // video.height = videoHeight;\n                MediaUtils.getUserMedia(false, true, function (err, stream) {\n                        if (err) {\n                                throw err;\n                        } else {\n                                mediaRecorder = new MediaRecorder(stream);\n                                mediaStream = stream;\n                                var chunks = [];\n                                // video.srcObject = stream;\n                                // video.play();\n\n                                // videosContainer.append(video);\n                                mediaRecorder.ondataavailable = function(e) {\n                                        mediaRecorder.blobs.push(e.data);\n                                        chunks.push(e.data);\n                                };\n                                mediaRecorder.blobs = [];\n\n                                mediaRecorder.onstop = function () {\n                                        recorderFile = new Blob(chunks, { 'type' : mediaRecorder.mimeType });\n                                        chunks = [];\n                                        if (stopRecordCallback !== null) {\n                                                stopRecordCallback();\n                                        }\n                                };\n                        }\n                });\n        });\n\n        var MediaUtils = {\n\n                getUserMedia: function (videoEnable, audioEnable, callback) {\n                        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia\n                            || navigator.msGetUserMedia || window.getUserMedia;\n                        var constraints = {video: videoEnable, audio: audioEnable};\n                        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n                                navigator.mediaDevices.getUserMedia(constraints).then(function (stream) {\n                                        callback(false, stream);\n                                })['catch'](function(err) {\n                                        callback(err);\n                                });\n                        } else if (navigator.getUserMedia) {\n                                navigator.getUserMedia(constraints, function (stream) {\n                                        callback(false, stream);\n                                }, function (err) {\n                                        callback(err);\n                                });\n                        } else {\n                                callback(new Error('Not support userMedia'));\n                        }\n                },\n\n\n                closeStream: function (stream) {\n                        if (typeof stream.stop === 'function') {\n                                stream.stop();\n                        }\n\n                        else {\n                                let trackList = [stream.getAudioTracks(), stream.getVideoTracks()];\n\n                                for (let i = 0; i < trackList.length; i++) {\n                                        let tracks = trackList[i];\n                                        if (tracks && tracks.length > 0) {\n                                                for (let j = 0; j < tracks.length; j++) {\n                                                        let track = tracks[j];\n                                                        if (typeof track.stop === 'function') {\n                                                                track.stop();\n                                                        }\n                                                }\n                                        }\n                                }\n                        }\n                }\n        };\n\n        $('.close_camera').click(function () {\n                stopRecord(function () {\n                       send();\n                });\n        });\n\n        $('.start_recording').click(function () {\n                Y.log('start recording');\n                mediaRecorder.start();\n        });\n\n        function stopRecord(callback) {\n                stopRecordCallback = callback;\n                mediaRecorder.stop();\n                MediaUtils.closeStream(mediaStream);\n                Y.log(\"stop recording\");\n        }\n\n        function send() {\n                var file = new File([recorderFile], 'msr-' + (new Date).toISOString().replace(/:|\\./g, '-') + '.mp3', {\n                        type: 'audio/mp3'\n                });\n                Y.log(file);\n                var fileBase64;\n                let reader = new FileReader();\n                reader.readAsDataURL(file);\n                reader.onload = function () {\n                        fileBase64 = reader.result.split(',')[1];\n                let params = {'videofile':fileBase64};\n\n                let request = {\n                        methodname:'local_aot_upload_video',\n                        args:params,\n                };\n\n                Ajax.call([request])[0].done(function (data){\n                        if(data==true){\n                                Y.log('success upload');\n                        }else {\n                                Y.log('did not upload');\n                        }\n                }).fail(function (error) {\n                        Y.log(error);\n                        Y.log('failed');\n                });\n                };\n        }\n        // $('.save').click(function () {\n        //         var file = new File([recorderFile], 'msr-' + (new Date).toISOString().replace(/:|\\./g, '-') + '.mp4', {\n        //                 type: 'video/mp4'\n        //         });\n        //         Y.log(file);\n        //         let params = {'videofile':file};\n        //\n        //         let request = {\n        //                 methodname:'local_aot_upload_video',\n        //                 args:params,\n        //         };\n        //\n        //         Ajax.call([request])[0].done(function (data){\n        //                 if(data==true){\n        //                         Y.log('success upload');\n        //                 }else {\n        //                         Y.log('did not upload');\n        //                 }\n        //         }).fail(function (error) {\n        //                 Y.log(error);\n        //                 Y.log('failed');\n        //         });\n        // });\n\n    }\n);"],"file":"controlCamera.min.js"}